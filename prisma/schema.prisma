generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = "postgresql://postgres.fgxvzejucaxteqvnhojt:1SgIUIbf7oki6qT6@aws-0-eu-central-1.pooler.supabase.com:6543/postgres?pgbouncer=true"
  directUrl = "postgresql://postgres.fgxvzejucaxteqvnhojt:1SgIUIbf7oki6qT6@aws-0-eu-central-1.pooler.supabase.com:5432/postgres"
}

model change_log {
  id          String      @id @default(uuid()) @db.Uuid
  einsatz_id  String      @db.Uuid
  user_id     String      @db.Uuid
  type_id     String      @db.Uuid
  created_at  DateTime    @default(now())
  einsatz     einsatz     @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  change_type change_type @relation(fields: [type_id], references: [id], onDelete: NoAction)
  user        user        @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model change_type {
  id              String       @id @default(uuid()) @db.Uuid
  change_type     String
  message         String?
  change_icon_url String?
  change_color    String
  change_log      change_log[]
}

model einsatz {
  id                String            @id @default(uuid()) @db.Uuid
  name              String
  created_at        DateTime          @default(now())
  updated_at        DateTime?
  start_date        DateTime
  participant_count Int?
  price_per_person  Float?
  total_price       Float?
  start_time        DateTime
  end_time          DateTime
  org_id            String            @db.Uuid
  created_by        String            @db.Uuid
  category_id       String?           @db.Uuid
  status_id         String?           @db.Uuid
  end_date          DateTime?         @db.Timestamp(6)
  template_id       String?           @db.Uuid
  change_log        change_log[]
  einsatz_category  einsatz_category? @relation(fields: [category_id], references: [id], onDelete: Cascade)
  user              user              @relation(fields: [created_by], references: [id], onDelete: Cascade)
  organization      organization      @relation(fields: [org_id], references: [id], onDelete: Cascade)
  einsatz_status    einsatz_status?   @relation(fields: [status_id], references: [id], onDelete: Cascade)
  einsatz_template  einsatz_template? @relation(fields: [template_id], references: [id])
  einsatz_comment   einsatz_comment[]
  einsatz_field     einsatz_field[]
  einsatz_helper    einsatz_helper[]
}

model einsatz_category {
  value      String
  identifier String
  id         String    @id @db.Uuid
  einsatz    einsatz[]
}

model einsatz_comment {
  created_at DateTime @default(now())
  einsatz_id String   @db.Uuid
  user_id    String   @db.Uuid
  comment    String
  id         String   @id @db.Uuid
  einsatz    einsatz  @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model einsatz_helper {
  einsatz_id String   @db.Uuid
  user_id    String   @db.Uuid
  joined_at  DateTime @default(now())
  id         String   @id @db.Uuid
  einsatz    einsatz  @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model einsatz_status {
  status  Json
  id      String    @id @db.Uuid
  einsatz einsatz[]
}

model einsatz_template {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  org_id         String?          @db.Uuid
  name           String?
  created_by     String?          @db.Uuid
  created_at     DateTime         @default(now())
  icon_url       String?
  description    String?
  einsatz        einsatz[]
  user           user?            @relation(fields: [created_by], references: [id], onDelete: Cascade)
  organization   organization?    @relation(fields: [org_id], references: [id], onDelete: Cascade)
  template_field template_field[]
}

model organization {
  id                     String                   @id @default(uuid()) @db.Uuid
  name                   String
  logo_url               String?
  description            String?
  helper_name_singular   String?                  @default("Vermittler:in")
  helper_name_plural     String?                  @default("Vermittler:innen")
  created_at             DateTime                 @default(now())
  updated_at             DateTime?
  einsatz_name_singular  String                   @default("Einsatz")
  einsatz_name_plural    String                   @default("Eins√§tze")
  einsatz                einsatz[]
  einsatz_template       einsatz_template[]
  invitation             invitation[]
  organization_property  organization_property[]
  user_organization_role user_organization_role[]
}

model organization_property {
  id            String          @id @default(uuid()) @db.Uuid
  org_id        String          @db.Uuid
  key           String
  property      String
  is_required   Boolean         @default(false)
  type_id       String          @db.Uuid
  organization  organization    @relation(fields: [org_id], references: [id], onDelete: Cascade)
  type          type            @relation(fields: [type_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_property user_property[]
}

model roles {
  id                   String                 @id @default(uuid()) @db.Uuid
  name                 String
  abbreviation         String?
  user_role_assignment user_role_assignment[]
}

model type {
  id                    String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                  String?
  field                 field[]
  organization_property organization_property[]
}

model user {
  id                      String                   @id @default(uuid()) @db.Uuid
  email                   String                   @unique
  firstname               String?
  lastname                String?
  password                String
  phone                   String?
  created_at              DateTime                 @default(now())
  updated_at              DateTime?
  picture_url             String?
  description             String?
  resetToken              String?
  resetTokenExpires       DateTime?
  last_login              DateTime?                @db.Timestamp(6)
  hasLogoinCalendar       Boolean                  @default(true)
  last_read_notifications DateTime?                @db.Timestamptz(6)
  change_log              change_log[]
  einsatz                 einsatz[]
  einsatz_comment         einsatz_comment[]
  einsatz_helper          einsatz_helper[]
  einsatz_template        einsatz_template[]
  invitation              invitation[]
  user_organization_role  user_organization_role[]
}

model user_organization_role {
  id                     String                 @id(map: "user_organization_rol_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                String                 @db.Uuid
  org_id                 String                 @db.Uuid
  created_at             DateTime               @default(now()) @db.Timestamptz(6)
  hasGetMailNotification Boolean                @default(true)
  organization           organization           @relation(fields: [org_id], references: [id], onDelete: Cascade)
  user                   user                   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_property          user_property[]
  user_role_assignment   user_role_assignment[]
}

model user_property {
  id                     String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_org_role_id       String?                 @db.Uuid
  property_id            String?                 @db.Uuid
  organization_property  organization_property?  @relation(fields: [property_id], references: [id], onDelete: Cascade)
  user_organization_role user_organization_role? @relation(fields: [user_org_role_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model invitation {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String
  token        String       @unique
  created_at   DateTime     @default(now()) @db.Timestamptz(6)
  expires_at   DateTime     @db.Timestamp(6)
  invited_by   String       @db.Uuid
  accepted     Boolean      @default(false)
  org_id       String       @db.Uuid
  user         user         @relation(fields: [invited_by], references: [id], onDelete: Cascade)
  organization organization @relation(fields: [org_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model einsatz_field {
  id         BigInt  @id @default(autoincrement())
  einsatz_id String  @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  field_id   String  @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  value      String?
  einsatz    einsatz @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  field      field   @relation(fields: [field_id], references: [id], onDelete: SetNull)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model field {
  id             String           @id(map: "custom_field_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String?
  type_id        String?          @db.Uuid
  is_required    Boolean?
  placeholder    String?
  default_value  String?
  group_name     String?
  einsatz_field  einsatz_field[]
  type           type?            @relation(fields: [type_id], references: [id], onDelete: Cascade, map: "custom_field_type_id_fkey")
  template_field template_field[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model template_field {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  template_id      String           @db.Uuid
  field_id         String           @db.Uuid
  field            field            @relation(fields: [field_id], references: [id], onDelete: Cascade)
  einsatz_template einsatz_template @relation(fields: [template_id], references: [id], onDelete: Cascade)
}

model user_role_assignment {
  id                        String                 @id @db.Uuid
  user_organization_role_id String                 @db.Uuid
  role_id                   String                 @db.Uuid
  roles                     roles                  @relation(fields: [role_id], references: [id], onDelete: Cascade)
  user_organization_role    user_organization_role @relation(fields: [user_organization_role_id], references: [id], onDelete: Cascade)

  @@unique([user_organization_role_id, role_id])
}
