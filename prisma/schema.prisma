generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model change_log {
  id                                  String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  einsatz_id                          String      @db.Uuid
  user_id                             String      @db.Uuid
  type_id                             String      @db.Uuid
  created_at                          DateTime    @default(now())
  affected_user                       String?     @db.Uuid
  user_change_log_affected_userTouser user?       @relation("change_log_affected_userTouser", fields: [affected_user], references: [id])
  einsatz                             einsatz     @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  change_type                         change_type @relation(fields: [type_id], references: [id], onDelete: NoAction)
  user                                user        @relation(fields: [user_id], references: [id], onDelete: SetNull)
}

model change_type {
  id              String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  message         String
  change_icon_url String
  change_color    String
  change_log      change_log[]
}

model einsatz {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title               String
  created_at          DateTime              @default(now())
  updated_at          DateTime?
  start               DateTime              @db.Timestamp(6)
  participant_count   Int?
  price_per_person    Float?
  total_price         Float?
  org_id              String                @db.Uuid
  created_by          String?               @db.Uuid
  template_id         String?               @db.Uuid
  all_day             Boolean               @default(false)
  end                 DateTime              @db.Timestamp(6)
  helpers_needed      Int                   @default(1) @db.SmallInt
  status_id           String                @default(dbgenerated("'bb169357-920b-4b49-9e3d-1cf489409370'::uuid")) @db.Uuid
  change_log          change_log[]
  user                user?                 @relation(fields: [created_by], references: [id])
  organization        organization          @relation(fields: [org_id], references: [id], onDelete: Cascade)
  einsatz_status      einsatz_status        @relation(fields: [status_id], references: [id], onDelete: NoAction)
  einsatz_template    einsatz_template?     @relation(fields: [template_id], references: [id])
  einsatz_comment     einsatz_comment[]
  einsatz_field       einsatz_field[]
  einsatz_helper      einsatz_helper[]
  einsatz_to_category einsatz_to_category[]
}

model einsatz_category {
  value               String
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  abbreviation        String                @default("")
  org_id              String                @db.Uuid
  organization        organization          @relation(fields: [org_id], references: [id], onDelete: Cascade)
  einsatz_to_category einsatz_to_category[]
}

model einsatz_comment {
  created_at DateTime @default(now())
  einsatz_id String   @db.Uuid
  user_id    String   @db.Uuid
  comment    String
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  einsatz    einsatz  @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model einsatz_helper {
  einsatz_id String   @db.Uuid
  user_id    String   @db.Uuid
  joined_at  DateTime @default(now())
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  einsatz    einsatz  @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model einsatz_template {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  org_id         String?          @db.Uuid
  name           String?
  created_by     String?          @db.Uuid
  created_at     DateTime         @default(now())
  description    String?
  icon_id        String           @default(dbgenerated("'17effde3-bacb-4cd9-9303-c0467a6e437b'::uuid")) @db.Uuid
  einsatz        einsatz[]
  user           user?            @relation(fields: [created_by], references: [id], onDelete: Cascade)
  template_icon  template_icon    @relation(fields: [icon_id], references: [id], onDelete: NoAction)
  organization   organization?    @relation(fields: [org_id], references: [id], onDelete: Cascade)
  template_field template_field[]
}

model organization {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String
  logo_url               String?
  description            String?
  helper_name_singular   String?                  @default("Vermittler:in")
  helper_name_plural     String?                  @default("Vermittler:innen")
  created_at             DateTime                 @default(now())
  updated_at             DateTime?
  einsatz_name_singular  String                   @default("Einsatz")
  einsatz_name_plural    String                   @default("Eins√§tze")
  einsatz                einsatz[]
  einsatz_category       einsatz_category[]
  einsatz_template       einsatz_template[]
  invitation             invitation[]
  user_organization_role user_organization_role[]
  user_property          user_property[]
}

model type {
  id          String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String?
  description String?
  icon_url    String?
  sort_order  Int?    @db.SmallInt
  datatype    String?
  field       field[]
}

model user {
  id                                        String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                                     String                   @unique
  firstname                                 String?
  lastname                                  String?
  password                                  String
  phone                                     String?
  created_at                                DateTime                 @default(now())
  updated_at                                DateTime?
  picture_url                               String?
  description                               String?
  resetToken                                String?
  resetTokenExpires                         DateTime?
  last_login                                DateTime?                @db.Timestamp(6)
  hasLogoinCalendar                         Boolean                  @default(true)
  last_read_notifications                   DateTime?                @db.Timestamptz(6)
  change_log_change_log_affected_userTouser change_log[]             @relation("change_log_affected_userTouser")
  change_log                                change_log[]
  einsatz                                   einsatz[]
  einsatz_comment                           einsatz_comment[]
  einsatz_helper                            einsatz_helper[]
  einsatz_template                          einsatz_template[]
  invitation                                invitation[]
  user_organization_role                    user_organization_role[]
  user_property_value                       user_property_value[]
}

model user_organization_role {
  id           String       @id(map: "user_organization_rol_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String       @db.Uuid
  org_id       String       @db.Uuid
  created_at   DateTime     @default(now()) @db.Timestamptz(6)
  role_id      String       @db.Uuid
  organization organization @relation(fields: [org_id], references: [id], onDelete: Cascade)
  role         role         @relation(fields: [role_id], references: [id], onDelete: NoAction)
  user         user         @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model user_property {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  field_id            String                @db.Uuid
  org_id              String                @db.Uuid
  field               field                 @relation(fields: [field_id], references: [id], onDelete: Cascade)
  organization        organization          @relation(fields: [org_id], references: [id], onDelete: Cascade)
  user_property_value user_property_value[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model invitation {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String
  token        String       @unique
  created_at   DateTime     @default(now()) @db.Timestamptz(6)
  expires_at   DateTime     @db.Timestamp(6)
  invited_by   String       @db.Uuid
  accepted     Boolean      @default(false)
  org_id       String       @db.Uuid
  user         user         @relation(fields: [invited_by], references: [id], onDelete: Cascade)
  organization organization @relation(fields: [org_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model einsatz_field {
  einsatz_id String  @db.Uuid
  field_id   String  @db.Uuid
  value      String?
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  einsatz    einsatz @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
  field      field   @relation(fields: [field_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model field {
  id             String           @id(map: "custom_field_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String?
  type_id        String?          @db.Uuid
  is_required    Boolean          @default(false)
  placeholder    String?
  default_value  String?
  group_name     String?
  is_multiline   Boolean?
  min            Int?             @db.SmallInt
  max            Int?             @db.SmallInt
  allowed_values String[]
  einsatz_field  einsatz_field[]
  type           type?            @relation(fields: [type_id], references: [id], onDelete: Cascade, map: "custom_field_type_id_fkey")
  template_field template_field[]
  user_property  user_property[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model template_field {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  template_id      String           @db.Uuid
  field_id         String           @db.Uuid
  field            field            @relation(fields: [field_id], references: [id], onDelete: Cascade)
  einsatz_template einsatz_template @relation(fields: [template_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model einsatz_to_category {
  einsatz_id       String           @db.Uuid
  category_id      String           @db.Uuid
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  einsatz_category einsatz_category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  einsatz          einsatz          @relation(fields: [einsatz_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model einsatz_status {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  helper_color    String
  verwalter_color String
  helper_text     String
  verwalter_text  String
  einsatz         einsatz[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model template_icon {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  icon_url         String             @default("")
  einsatz_template einsatz_template[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model role {
  id                     String                   @id(map: "roles_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String
  abbreviation           String?
  user_organization_role user_organization_role[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_property_value {
  id               String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String        @db.Uuid
  user_property_id String        @db.Uuid
  value            String
  user             user          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_property    user_property @relation(fields: [user_property_id], references: [id], onDelete: Cascade)
}
